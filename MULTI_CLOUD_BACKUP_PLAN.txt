# ğŸ“¦ Plano de ImplementaÃ§Ã£o: Backup Multi-Nuvem

## ğŸ¯ Objetivo
Implementar backup automÃ¡tico dos dados do usuÃ¡rio (transaÃ§Ãµes, agenda, categorias) para mÃºltiplos serviÃ§os de nuvem no app Flutter FinAgeVoz.

---

## ğŸ“Š Arquitetura Proposta

### **Estrutura de Camadas**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         UI (Sync Settings Screen)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     MultiCloudBackupService             â”‚
â”‚  (Orquestrador Central)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ Google â”‚  â”‚ OneDrive  â”‚  â”‚ Dropbox â”‚
â”‚ Drive  â”‚  â”‚  Service  â”‚  â”‚ Service â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ ServiÃ§os Suportados

### âœ… **Implementado**
1. **Google Drive** (via `google_drive_service.dart`)
2. **Firebase/Firestore** (via `cloud_sync_service.dart`)

### ğŸš§ **A Implementar**

#### **Prioridade ALTA** (Multiplataforma)
3. **Microsoft OneDrive**
   - SDK: `onedrive_api` (Flutter package)
   - AutenticaÃ§Ã£o: OAuth 2.0 (Microsoft Identity Platform)
   - Compatibilidade: Android, iOS, Web

4. **Dropbox**
   - SDK: `dropbox_client` (Flutter package)
   - AutenticaÃ§Ã£o: OAuth 2.0 (Dropbox App Console)
   - Compatibilidade: Android, iOS, Web

#### **Prioridade MÃ‰DIA** (LimitaÃ§Ãµes de Plataforma)
5. **pCloud**
   - SDK: API REST prÃ³pria (HTTP client)
   - AutenticaÃ§Ã£o: OAuth 2.0
   - Compatibilidade: Android, iOS, Web

6. **Mega**
   - SDK: `mega` (Dart package nÃ£o oficial)
   - AutenticaÃ§Ã£o: Email/Password ou Session Token
   - Compatibilidade: Android, iOS, Web
   - âš ï¸ **LimitaÃ§Ã£o:** API nÃ£o oficial, pode quebrar

7. **Box**
   - SDK: API REST (HTTP client)
   - AutenticaÃ§Ã£o: OAuth 2.0 (Box Developer Console)
   - Compatibilidade: Android, iOS, Web

#### **Prioridade BAIXA** (Apenas iOS/macOS)
8. **iCloud Drive**
   - SDK: Nativo iOS/macOS apenas
   - AutenticaÃ§Ã£o: Apple ID automÃ¡tico
   - Compatibilidade: **APENAS iOS/macOS**
   - âš ï¸ **LimitaÃ§Ã£o:** Requer cÃ³digo nativo Swift/Objective-C

---

## ğŸ—ï¸ ImplementaÃ§Ã£o TÃ©cnica

### **Fase 1: AbstraÃ§Ã£o de Interface**

Criar uma interface comum para todos os serviÃ§os:

```dart
abstract class CloudStorageProvider {
  String get providerName;
  bool get isSignedIn;
  String? get userEmail;
  
  Future<bool> signIn();
  Future<void> signOut();
  Future<String?> uploadBackup(Uint8List data, BackupMetadata metadata);
  Future<List<BackupMetadata>> listBackups();
  Future<Uint8List> downloadBackup(String fileId);
  Future<void> deleteBackup(String fileId);
  Future<bool> verifyChecksum(String fileId, String expectedHash);
}
```

### **Fase 2: ImplementaÃ§Ã£o dos ServiÃ§os**

#### **OneDrive Service**
```dart
class OneDriveService implements CloudStorageProvider {
  // Usar package: onedrive_api
  // OAuth 2.0 via Microsoft Identity Platform
  // Endpoint: https://graph.microsoft.com/v1.0/me/drive
}
```

#### **Dropbox Service**
```dart
class DropboxService implements CloudStorageProvider {
  // Usar package: dropbox_client
  // OAuth 2.0 via Dropbox App Console
  // Endpoint: https://api.dropboxapi.com/2/files/upload
}
```

#### **pCloud Service**
```dart
class PCloudService implements CloudStorageProvider {
  // HTTP Client direto
  // OAuth 2.0
  // Endpoint: https://api.pcloud.com/
}
```

### **Fase 3: Orquestrador Multi-Nuvem**

```dart
class MultiCloudBackupService {
  final List<CloudStorageProvider> _providers = [];
  
  // Registrar provedores ativos
  void registerProvider(CloudStorageProvider provider) {
    _providers.add(provider);
  }
  
  // Backup paralelo para todos os provedores
  Future<Map<String, BackupResult>> backupToAll(Uint8List data) async {
    final results = <String, BackupResult>{};
    
    await Future.wait(_providers.map((provider) async {
      try {
        final fileId = await provider.uploadBackup(data, metadata);
        final verified = await provider.verifyChecksum(fileId, hash);
        results[provider.providerName] = BackupResult(
          success: verified,
          fileId: fileId,
          timestamp: DateTime.now(),
        );
      } catch (e) {
        results[provider.providerName] = BackupResult(
          success: false,
          error: e.toString(),
        );
      }
    }));
    
    return results;
  }
  
  // Restaurar do provedor mais recente
  Future<Uint8List?> restoreFromBest() async {
    // LÃ³gica para escolher o backup mais recente/confiÃ¡vel
  }
}
```

---

## ğŸ” SeguranÃ§a e VerificaÃ§Ã£o

### **Checksum (SHA-256)**
```dart
import 'package:crypto/crypto.dart';

String calculateChecksum(Uint8List data) {
  return sha256.convert(data).toString();
}

Future<bool> verifyBackup(String fileId, String expectedHash) async {
  final data = await downloadBackup(fileId);
  final actualHash = calculateChecksum(data);
  return actualHash == expectedHash;
}
```

### **Criptografia (Opcional)**
```dart
import 'package:encrypt/encrypt.dart';

Uint8List encryptData(Uint8List data, String userPassword) {
  final key = Key.fromUtf8(userPassword.padRight(32));
  final iv = IV.fromLength(16);
  final encrypter = Encrypter(AES(key));
  return encrypter.encryptBytes(data, iv: iv).bytes;
}
```

---

## ğŸ“ Sistema de Logs

```dart
class BackupLogger {
  final List<BackupLogEntry> _logs = [];
  
  void log(String provider, bool success, {String? error}) {
    _logs.add(BackupLogEntry(
      provider: provider,
      timestamp: DateTime.now(),
      success: success,
      error: error,
    ));
  }
  
  List<BackupLogEntry> getRecentLogs({int limit = 50}) {
    return _logs.reversed.take(limit).toList();
  }
}
```

---

## ğŸ¨ UI/UX

### **Tela de ConfiguraÃ§Ã£o**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backup Multi-Nuvem                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â˜ï¸ Google Drive        [âœ“ Ativo]  â”‚
â”‚     usuario@gmail.com               â”‚
â”‚     Ãšltimo backup: 19/12 05:30      â”‚
â”‚                                     â”‚
â”‚  â˜ï¸ OneDrive           [Conectar]   â”‚
â”‚                                     â”‚
â”‚  â˜ï¸ Dropbox            [Conectar]   â”‚
â”‚                                     â”‚
â”‚  â˜ï¸ pCloud             [Conectar]   â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Fazer Backup Agora]               â”‚
â”‚  [Ver HistÃ³rico de Logs]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ DependÃªncias NecessÃ¡rias

### **pubspec.yaml**
```yaml
dependencies:
  # JÃ¡ existentes
  google_sign_in: ^6.2.1
  googleapis: ^13.2.0
  firebase_auth: ^5.3.3
  
  # Novos
  onedrive_api: ^1.0.0  # OneDrive
  dropbox_client: ^0.7.1  # Dropbox
  http: ^1.2.0  # Para pCloud, Box, Mega
  crypto: ^3.0.3  # Para checksums
  encrypt: ^5.0.3  # Para criptografia (opcional)
```

---

## ğŸš€ Roadmap de ImplementaÃ§Ã£o

### **Sprint 1: FundaÃ§Ã£o** (1 semana)
- [ ] Criar interface `CloudStorageProvider`
- [ ] Refatorar `GoogleDriveService` para implementar a interface
- [ ] Criar `MultiCloudBackupService` (orquestrador)
- [ ] Implementar sistema de logs

### **Sprint 2: OneDrive** (1 semana)
- [ ] Configurar OAuth no Microsoft Azure
- [ ] Implementar `OneDriveService`
- [ ] Testes de upload/download
- [ ] Implementar verificaÃ§Ã£o de checksum

### **Sprint 3: Dropbox** (1 semana)
- [ ] Configurar OAuth no Dropbox App Console
- [ ] Implementar `DropboxService`
- [ ] Testes de upload/download
- [ ] IntegraÃ§Ã£o com orquestrador

### **Sprint 4: pCloud e Box** (1 semana)
- [ ] Implementar `PCloudService` (HTTP direto)
- [ ] Implementar `BoxService` (HTTP direto)
- [ ] Testes de integraÃ§Ã£o

### **Sprint 5: UI e Polimento** (1 semana)
- [ ] Criar tela de configuraÃ§Ã£o multi-nuvem
- [ ] Implementar histÃ³rico de logs
- [ ] Testes de usuÃ¡rio
- [ ] DocumentaÃ§Ã£o

---

## âš ï¸ LimitaÃ§Ãµes e ConsideraÃ§Ãµes

### **iCloud Drive**
- âŒ **NÃ£o Ã© viÃ¡vel** para Android
- âœ… PossÃ­vel apenas para iOS/macOS com cÃ³digo nativo
- ğŸ’¡ **Alternativa:** Usar CloudKit (requer conta Apple Developer)

### **Mega**
- âš ï¸ API nÃ£o oficial, pode quebrar sem aviso
- ğŸ’¡ **Alternativa:** Usar API REST oficial (se disponÃ­vel)

### **Quotas e Limites**
| ServiÃ§o    | EspaÃ§o GrÃ¡tis | Limite de Upload |
|------------|---------------|------------------|
| Google Drive | 15 GB       | 750 GB/dia       |
| OneDrive   | 5 GB          | Sem limite       |
| Dropbox    | 2 GB          | Sem limite       |
| pCloud     | 10 GB         | Sem limite       |
| Mega       | 20 GB         | 5 GB/6h (free)   |
| Box        | 10 GB         | 250 MB/arquivo   |

---

## ğŸ¯ PrÃ³ximos Passos

1. **DecisÃ£o:** Quais serviÃ§os implementar primeiro?
   - Recomendo: **OneDrive** e **Dropbox** (mais estÃ¡veis e populares)

2. **ConfiguraÃ§Ã£o OAuth:**
   - Criar apps nas consoles de desenvolvedor
   - Obter Client IDs e Secrets

3. **ImplementaÃ§Ã£o:**
   - ComeÃ§ar pela interface abstrata
   - Implementar um serviÃ§o por vez
   - Testar exaustivamente

---

## ğŸ“ Suporte e DocumentaÃ§Ã£o

- **OneDrive:** https://learn.microsoft.com/en-us/onedrive/developer/
- **Dropbox:** https://www.dropbox.com/developers/documentation
- **pCloud:** https://docs.pcloud.com/
- **Box:** https://developer.box.com/
- **Mega:** https://mega.nz/developers

---

**Criado em:** 19/12/2024  
**Autor:** Antigravity AI  
**Projeto:** FinAgeVoz Multi-Cloud Backup
