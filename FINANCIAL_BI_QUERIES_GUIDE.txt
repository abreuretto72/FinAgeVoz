# üìä Business Intelligence - Consultas Financeiras Avan√ßadas por Voz

## üéØ Objetivo
Aprimorar o sistema de processamento de consultas financeiras por voz do FinAgeVoz com capacidades avan√ßadas de Business Intelligence.

---

## üîë REGRAS CR√çTICAS PARA RESPOSTAS OTIMIZADAS PARA VOZ

### 1. **Audio-First (√Åudio em Primeiro Lugar)**
- Respostas ser√£o FALADAS, n√£o mostradas
- Evite tabelas, bullet points ou formata√ß√£o complexa
- Use linguagem natural e fluida

### 2. **Arredondar N√∫meros**
- ‚úÖ "cerca de 150 reais"
- ‚ùå "cento e cinquenta reais e quarenta e dois centavos"

### 3. **Priorizar Urg√™ncia**
- SEMPRE mencione itens atrasados ou de hoje PRIMEIRO
- Exemplo: "Aten√ß√£o! Voc√™ tem uma conta vencida..."

### 4. **Tom Emp√°tico**
- Use linguagem de apoio
- "Voc√™ est√° indo bem!" ou "Vamos organizar isso juntos."

### 5. **Perguntas Vagas**
- Se usu√°rio for vago (ex: "Como est√£o minhas contas?")
- Mostrar o que vence nos pr√≥ximos 3 dias

---

## üìã TIPOS DE CONSULTAS & EXEMPLOS

### A. CONSULTAS DE AGREGA√á√ÉO (Soma, M√©dia, Contagem)

#### **Inten√ß√£o:** Calcular totais, m√©dias ou contagens baseadas em filtros

#### **Exemplos:**

**1. Soma por Categoria**
```
Pergunta: "Quanto eu gastei com combust√≠vel m√™s passado?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "SUM",
    "category": "Transporte",
    "subcategory": "Combust√≠vel",
    "period": "LAST_MONTH",
    "type": "EXPENSE"
  }
}

Resposta: "Voc√™ gastou cerca de [valor] com combust√≠vel no m√™s passado."
```

**2. M√©dia de Gastos**
```
Pergunta: "Qual foi minha m√©dia de gastos com alimenta√ß√£o este ano?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "AVERAGE",
    "category": "Alimenta√ß√£o",
    "period": "THIS_YEAR",
    "type": "EXPENSE",
    "groupBy": "MONTH"
  }
}

Resposta: "Sua m√©dia mensal com alimenta√ß√£o este ano foi de [valor]."
```

**3. Contagem de Transa√ß√µes**
```
Pergunta: "Quantas vezes comi fora este m√™s?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "COUNT",
    "category": "Alimenta√ß√£o",
    "subcategory": "Restaurantes",
    "period": "THIS_MONTH",
    "type": "EXPENSE"
  }
}

Resposta: "Voc√™ comeu fora [n√∫mero] vezes este m√™s."
```

---

### B. CONSULTAS DE OR√áAMENTO (Posso Pagar?)

#### **Inten√ß√£o:** Verificar se o usu√°rio pode pagar algo baseado no saldo e despesas pendentes

#### **Exemplos:**

**1. Verifica√ß√£o de Compra**
```
Pergunta: "Posso comprar uma pizza hoje?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "CHECK_BUDGET",
    "category": "Alimenta√ß√£o",
    "estimatedAmount": 50,
    "period": "THIS_MONTH"
  }
}

L√≥gica de Resposta:
1. Calcular: Dispon√≠vel = Saldo - Despesas Pendentes
2. Verificar se Dispon√≠vel >= Valor Estimado
3. Resposta: "Seu saldo dispon√≠vel para lazer √© [valor]. [Sim/N√£o], isso cabe no seu planejamento."
```

**2. Planejamento de Viagem**
```
Pergunta: "D√° para viajar no final do m√™s?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "CHECK_BUDGET",
    "category": "Lazer",
    "period": "END_OF_MONTH"
  }
}

Resposta: "Considerando suas contas pendentes, voc√™ ter√° cerca de [valor] dispon√≠vel. [Recomenda√ß√£o]."
```

---

### C. CONSULTAS DE COMPARA√á√ÉO (Isso vs Aquilo)

#### **Inten√ß√£o:** Comparar gastos/receitas entre per√≠odos ou categorias

#### **Exemplos:**

**1. Compara√ß√£o de Per√≠odos**
```
Pergunta: "Gastei mais este m√™s ou no m√™s passado?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "COMPARE",
    "type": "EXPENSE",
    "periods": ["THIS_MONTH", "LAST_MONTH"]
  }
}

Resposta: "Este m√™s voc√™ gastou [valor], enquanto no m√™s passado foi [valor]. Voc√™ gastou [mais/menos]."
```

**2. Compara√ß√£o de Categorias**
```
Pergunta: "Onde gastei mais: mercado ou restaurantes?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "COMPARE",
    "categories": ["Alimenta√ß√£o/Mercado", "Alimenta√ß√£o/Restaurantes"],
    "period": "THIS_MONTH"
  }
}

Resposta: "Voc√™ gastou [valor] no mercado e [valor] em restaurantes. [Categoria maior] foi o maior gasto."
```

---

### D. AN√ÅLISE DE TEND√äNCIAS (Padr√µes ao Longo do Tempo)

#### **Inten√ß√£o:** Identificar padr√µes de gastos/receitas

#### **Exemplos:**

**1. Tend√™ncia de Categoria**
```
Pergunta: "Estou gastando mais ou menos com sa√∫de?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "TREND",
    "category": "Sa√∫de",
    "period": "LAST_6_MONTHS"
  }
}

Resposta: "Nos √∫ltimos 6 meses, seus gastos com sa√∫de [aumentaram/diminu√≠ram/estabilizaram]. M√©dia: [valor]."
```

**2. Tend√™ncia Geral**
```
Pergunta: "Meus gastos est√£o aumentando?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "TREND",
    "type": "EXPENSE",
    "period": "LAST_3_MONTHS"
  }
}

Resposta: "Comparando os √∫ltimos 3 meses, seus gastos [tend√™ncia]. [Recomenda√ß√£o]."
```

---

### E. CONSULTAS DE RANKING (Top/Bottom)

#### **Inten√ß√£o:** Encontrar maiores/menores gastos ou categorias

#### **Exemplos:**

**1. Maior Despesa**
```
Pergunta: "Qual minha maior despesa este m√™s?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "TOP",
    "type": "EXPENSE",
    "period": "THIS_MONTH",
    "limit": 1
  }
}

Resposta: "Sua maior despesa este m√™s foi [descri√ß√£o] no valor de [valor]."
```

**2. Top 3 Categorias**
```
Pergunta: "Quais minhas 3 maiores categorias de gasto?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "TOP",
    "type": "EXPENSE",
    "groupBy": "CATEGORY",
    "period": "THIS_MONTH",
    "limit": 3
  }
}

Resposta: "Suas maiores categorias s√£o: [cat1] com [valor], [cat2] com [valor], e [cat3] com [valor]."
```

---

### F. CONSULTAS DE ALERTA (Sa√∫de Financeira)

#### **Inten√ß√£o:** Identificar problemas ou riscos financeiros

#### **Exemplos:**

**1. Contas Atrasadas**
```
Pergunta: "Tenho alguma conta atrasada?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "ALERT",
    "status": "OVERDUE"
  }
}

Resposta: "Aten√ß√£o! Voc√™ tem [n√∫mero] conta(s) atrasada(s): [lista]. Total: [valor]."
```

**2. Alerta de Gasto Excessivo**
```
Pergunta: "Estou gastando demais?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "ALERT",
    "type": "OVERSPENDING",
    "period": "THIS_MONTH"
  }
}

L√≥gica:
1. Comparar gastos do m√™s atual vs m√©dia dos √∫ltimos 3 meses
2. Se > 20% maior: "Aten√ß√£o! Voc√™ est√° gastando [percentual] a mais que sua m√©dia."
3. Se normal: "Seus gastos est√£o dentro do normal."
```

**3. Pergunta Vaga (IMPORTANTE)**
```
Pergunta: "Como est√£o minhas contas?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "ALERT",
    "status": "PENDING",
    "period": "NEXT_3_DAYS"
  }
}

Resposta: "Nos pr√≥ximos 3 dias voc√™ tem [n√∫mero] conta(s) para pagar, totalizando [valor]. [Lista]."
```

---

### G. CONSULTAS ESPEC√çFICAS (Encontrar Detalhes)

#### **Inten√ß√£o:** Obter detalhes sobre uma transa√ß√£o ou categoria espec√≠fica

#### **Exemplos:**

**1. Data de Vencimento**
```
Pergunta: "Quando vence o IPVA?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "FIND",
    "keywords": "IPVA",
    "extractField": "dueDate"
  }
}

Resposta: "O IPVA vence em [data]."
```

**2. Valor de Conta**
```
Pergunta: "Quanto √© a conta da internet?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "FIND",
    "keywords": "internet",
    "extractField": "amount"
  }
}

Resposta: "A conta da internet √© de [valor]."
```

**3. Status de Pagamento**
```
Pergunta: "J√° paguei o condom√≠nio?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "FIND",
    "keywords": "condom√≠nio",
    "extractField": "status"
  }
}

Resposta: "[Sim/N√£o], voc√™ [j√° pagou/ainda n√£o pagou] o condom√≠nio."
```

---

### H. CONSULTAS DE SALDO & PROJE√á√ÉO

#### **Inten√ß√£o:** Verificar saldo atual ou projetar saldo futuro

#### **Exemplos:**

**1. Saldo Atual**
```
Pergunta: "Qual meu saldo?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "BALANCE",
    "type": "CURRENT"
  }
}

Resposta: "Seu saldo atual √© de [valor]."
```

**2. Proje√ß√£o de Saldo**
```
Pergunta: "Quanto vou ter no final do m√™s?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "BALANCE",
    "type": "PROJECTED",
    "period": "END_OF_MONTH"
  }
}

L√≥gica: Saldo Atual + Receitas Pendentes - Despesas Pendentes

Resposta: "Considerando suas receitas e despesas pendentes, voc√™ ter√° cerca de [valor] no final do m√™s."
```

**3. Verifica√ß√£o de Saldo Negativo**
```
Pergunta: "Vou ficar no vermelho?"

JSON:
{
  "intent": "QUERY",
  "query": {
    "domain": "FINANCE",
    "operation": "BALANCE",
    "type": "PROJECTED",
    "period": "END_OF_MONTH",
    "checkNegative": true
  }
}

Resposta: "[Sim/N√£o]. [Se sim: Recomenda√ß√£o de a√ß√£o]."
```

---

## üé® DIRETRIZES DE ESTILO DE RESPOSTA

### **Estrutura de Resposta em 4 Partes:**

1. **Empatia Primeiro**: Comece com valida√ß√£o
   - "Entendo sua preocupa√ß√£o..."
   - "Boa pergunta!"
   - "Vamos ver isso juntos..."

2. **N√∫meros em Segundo**: Declare a resposta claramente
   - "Voc√™ gastou cerca de 500 reais."
   - "Seu saldo √© de 1.200 reais."

3. **Contexto em Terceiro**: Adicione contexto √∫til
   - "Isso √© 20% a mais que o m√™s passado."
   - "Est√° dentro da sua m√©dia."

4. **A√ß√£o por √öltimo**: Sugira pr√≥ximos passos se relevante
   - "Quer que eu liste os detalhes?"
   - "Posso ajudar a organizar isso?"

### **Exemplo de Resposta Completa:**

```
Usu√°rio: "Quanto gastei com mercado este m√™s?"

IA: "Boa pergunta! Voc√™ gastou cerca de 450 reais com mercado este m√™s. 
     Isso est√° um pouco acima da sua m√©dia de 400 reais. 
     Quer saber onde voc√™ pode economizar?"
```

---

## üìÖ MAPEAMENTO DE PER√çODOS

| Per√≠odo | Descri√ß√£o |
|---------|-----------|
| TODAY | Dia atual |
| YESTERDAY | Dia anterior |
| THIS_WEEK | Segunda a domingo da semana atual |
| LAST_WEEK | Semana anterior |
| THIS_MONTH | Dia 1 ao √∫ltimo dia do m√™s atual |
| LAST_MONTH | M√™s anterior |
| THIS_YEAR | 1¬∫ de janeiro a 31 de dezembro do ano atual |
| LAST_YEAR | Ano anterior |
| NEXT_3_DAYS | Hoje + 3 dias |
| NEXT_WEEK | Pr√≥xima segunda a domingo |
| NEXT_MONTH | Pr√≥ximo m√™s |
| END_OF_MONTH | √öltimo dia do m√™s atual |
| THIS_WEEKEND | Pr√≥ximo s√°bado e domingo |

---

## üöÄ IMPLEMENTA√á√ÉO

Para implementar essas melhorias no `ai_service.dart`, adicione a se√ß√£o acima ap√≥s a linha 638 (antes da se√ß√£o "5. GREETING / CHAT").

Isso expandir√° significativamente as capacidades de Business Intelligence do FinAgeVoz!

---

**Criado em:** 19/12/2024  
**Autor:** Antigravity AI  
**Projeto:** FinAgeVoz Business Intelligence Enhancement
